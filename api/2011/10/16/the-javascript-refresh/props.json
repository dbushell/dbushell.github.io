{
  "dateUnix": 1318782609000,
  "dateFormatted": "Sunday 16 Oct 2011",
  "pageHeading": "The JavaScript Refresh",
  "pagePath": "/2011/10/16/the-javascript-refresh/",
  "innerHTML": "<p>Those of us who care a little about progressive enhancement and accessibility will be well aware of the “JavaScript refresh”. This is when the page initially renders — visible to the user — before deferred JavaScript kicks in. Think jQuery’s <code>$(document).ready()</code> or similar.</p>\n<p>This problem occurs from very good practices. We have to make sure pages are accessible pre-JavaScript. Not because we’re worried users are browsing with JavaScript disabled, but to ensure websites do not <em>rely</em> on JavaScript to be accessible (great for SEO too).</p>\n<p>There’s a nice technique to avoid the annoying visual kick.</p>\n<h2 id=\"document-ready\">Document Ready?</h2>\n<p>The trick is understanding how JavaScript executes. For religious jQuery users like I’m forever living inside the <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"http://api.jquery.com/ready/\">document ready event</a>.</p>\n<blockquote>\n<p>While JavaScript provides the load event for executing code when a page is rendered, this event does not get triggered until all assets such as images have been completely received. In most cases, the script can be run as soon as the DOM hierarchy has been fully constructed.</p>\n</blockquote>\n<p>This means that the whole DOM has loaded and is ready to be manipulated. Sadly for us it also means the web browser has likely rendered the page and all its default visual states. Seeing JavaScript force a re-render is not a nice effect.</p>\n<p>The solution? Add a <strong><code>.no-js</code></strong> class to your opening <code>html</code> element, then remove it as soon as possible with JavaScript. In your <code>head</code> write:</p>\n<pre><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\ndocHTML <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\ndocHTML<span class=\"token punctuation\">.</span>className <span class=\"token operator\">=</span> docHTML<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\bno-js\\b/</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">' js'</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>This replaces your hardcoded <strong><code>.no-js</code></strong> with a <strong><code>.js</code></strong> class immediately.</p>\n<p>Whether you choose to use write default CSS <em>for</em> JavaScript and use the <strong><code>.no-js</code></strong> class to override, or do it the other way around, you can now make sure the right CSS is going to be applied the first time, safe in the knowledge that DOM-ready scripts will soon kick in.</p>\n<p>What’s going on here — JavaScript in the <code>head</code> element? If you’re familiar with <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"http://www.modernizr.com/\">Modernizr</a> you’ll have seen this before as it uses a similar technique, that’s where I stole it from! See <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"http://paulirish.com/2009/avoiding-the-fouc-v3/\">Paul Irish’s</a> example from 2009.</p>\n<p>The key to this working is having the JavaScript execute as soon as possible, <em>before</em> the document renders. That’s normally a big “no” in development for two reasons: it halts page rendering, and it enters a race condition where the script may try to change elements that haven’t loaded yet. In this case we know the <code>html</code> element exists and we sacrifice a minuscule performance hit for a bigger reward — no nasty page refreshing and no heavy restyling.</p>\n<p>This technique has been around for years but in today’s JavaScript-happy world it’s good to remind ourselves about staying accessible and <a href=\"/2011/10/01/building-for-future-design/\">getting the basics right</a> for users.</p>\n",
  "pageExcerpt": "Those of us who care a little about progressive enhancement and accessibility will be well aware of the “JavaScript refresh”. This is when the page initially renders — visible to the user — before deferred JavaScript kicks in. Think jQuery’s $(document).ready() or similar.\nThis problem occurs from very good practices. We have to make sure pages are accessible pre-JavaScript. […]",
  "pageTitle": "The JavaScript Refresh – David Bushell – Web Design (UK)"
}