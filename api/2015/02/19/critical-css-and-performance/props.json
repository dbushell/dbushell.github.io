{
  "dateUnix": 1424365085000,
  "dateFormatted": "Thursday 19 Feb 2015",
  "pageHeading": "Critical CSS and Performance",
  "pagePath": "/2015/02/19/critical-css-and-performance/",
  "innerHTML": "<p><a href=\"/2014/04/24/two-week-build/\">I built my website</a> last year with a strong focus on <strong>front-end performance</strong>.</p>\n<p>This week inspired by Scott Jehl’s article <a href=\"http://www.filamentgroup.com/lab/performance-rwd.html\">“How we make RWD sites load fast as heck”</a> and Callum Hart’s <a href=\"http://www.callumhart.com/blog/non-blocking-uis-with-interface-previews\">“Non-blocking UI’s with interface previews”</a> I decided to revisit my code and give it another boost. The trick to getting content on screen faster is removing <a href=\"https://developers.google.com/speed/docs/insights/OptimizeCSSDelivery\">render-blocking CSS</a>. When the browser sees a stylesheet —</p>\n<pre><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n</code></pre>\n<p>— it will not render further until it’s downloaded.</p>\n<p>By inlining critical CSS the browser can start to render immediately while the rest is downloaded asynchronously. What is critical CSS? Anything <a href=\"http://iamthefold.com/\">above the fold</a> apparently. <a href=\"http://developers.google.com/speed/pagespeed/insights/\">PageSpeed Insights</a> is a useful tool. My original stylesheet was only 35KB so I was skeptical that I’d see any improvements. Nevertheless, I manually extracted 10KB of typographic and layout styles to inline.</p>\n<p>My page <code>&lt;head&gt;</code> now looks something like this:</p>\n<pre><code class=\"language-markup\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>noscript</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>combined.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>noscript</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style language-css\"> <span class=\"token comment\">/* 10KB of inline CSS */</span> </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"> <span class=\"token comment\">/* ... */</span> <span class=\"token function\">loadCSS</span><span class=\"token punctuation\">(</span><span class=\"token string\">'style.css'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre>\n<ul>\n<li><code>&lt;noscript&gt;</code> as a fallback to provide the original stylesheet</li>\n<li>10KB of inline CSS that can be rendered straight away</li>\n<li>JavaScript to asynchronously download more (see <a href=\"https://github.com/filamentgroup/loadCSS\">loadCSS</a> by Filament Group)</li>\n</ul>\n<h2 id=\"the-results\">The Results</h2>\n<p>To see if this technique improves ‘time to visible content’, I’m using <a href=\"https://developer.chrome.com/devtools/docs/device-mode\">Chrome’s device emulator</a> to throttle the network speed to its slowest setting: GPRS (50Kbps 500ms RTT), equivalent to an awful 2G signal.</p>\n<p>In relatable numbers that’s a download speed of 6.25KB/s. Therefore my homepage, weighing in at 220KB, will take at least 35 seconds to download at this speed (not accounting for latency).</p>\n<p>In <a href=\"https://vimeo.com/119967106\">the video below</a> you can see my site download before and after optimisation.</p>\n<p class=\"b-post__image\"><span class=\"b-fitvid\" style=\"padding-top:56.25%\"><iframe src=\"//player.vimeo.com/video/119967106?color=99cc66\" frameborder=\"0\" allowfullscreen=\"allowfullscreen\"></iframe></span></p>\n\n\n\n<p>If you’ve been paying attention the point of this optimisation isn’t to download the entire page faster, but to render content sooner. The results are impressive. Across multiple tests I’ve found that content is on screen <strong>at least 6 seconds earlier</strong> than before.</p>\n<p>Of course, with faster networks the difference becomes less apparent. Subsequent visits can benefit from browser caching which negates the main issue, but given the nature of my blog traffic a primed cache isn’t common.</p>\n<p>I’m rather happy with that!</p>\n<p>There’s still work to do though. I get the sense that some of the later assets are tripping over themselves. I want to ensure that non-critical, asynchronous CSS is still prioritised before other resources.</p>\n<p>Have some thoughts? Let me know <a href=\"http://twitter.com/dbushell\">@dbushell</a>.</p>\n",
  "pageExcerpt": "I built my website last year with a strong focus on front-end performance.\nThis week inspired by Scott Jehl’s article “How we make RWD sites load fast as heck” and Callum Hart’s “Non-blocking UI’s with interface previews” I decided to revisit my code and give it another boost. The trick to getting content on screen faster […]",
  "pageTitle": "Critical CSS and Performance – David Bushell – Web Design (UK)"
}