{
  "dateUnix": 1583402400000,
  "dateFormatted": "Thursday 5 Mar 2020",
  "pageHeading": "Bundle a PWA as an Android App",
  "pagePath": "/2020/03/05/bundle-a-pwa-as-an-android-app/",
  "innerHTML": "<p>A <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps\">Progressive Web App (PWA)</a> is a website with a few extra pieces.</p>\n<p>PWAs can be installed or bookmarked from the browser using “Add to Home Screen”. On Android 9 doing this via Firefox (v68, left) and Chrome (v80, right) gives two different results on my Samsung S8:</p>\n<p class=\"b-post__image\">\n  <img loading=\"lazy\" srcset=\"\n    /images/blog/2020/ms-homescreen-icons@1x.png,\n    /images/blog/2020/ms-homescreen-icons@2x.png 2x\"\n    src=\"/images/blog/2020/ms-homescreen-icons@1x.png\"\n    alt=\"Mute Swan PWA Homescreen Icons\"\n    width=\"340\"\n    height=\"180\">\n</p>\n\n<p>The Firefox icon isn’t desirable. Although the Firefox bookmark does open like a fullscreen app, Chrome uses <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://developers.google.com/web/fundamentals/integration/webapks\">WebAPK</a> to wrap the PWA. This offers better Android integration. However, the app wont be listed in the Play Store.</p>\n<p>Not quite a first-class citizen.</p>\n<h2 id=\"building-an-apk\">Building an APK</h2>\n<p>To get into an app store an APK is required (the package format for apps). Why is this desirable? For better discoverability and monetisation perhaps. Or just for fun — usually my rationale on such projects.</p>\n<p>With <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://developers.google.com/web/updates/2019/02/using-twa\">Trusted Web Activities (TWA)</a> this is fairly easy. TWA is a way to use Chrome sans the UI inside an Android app. An app that is effectively just a portal to the PWA. It’s sandboxed and can’t access native APIs. Just like WebAPK then, but the result is an app bundle that can be uploaded to the store.</p>\n<h2 id=\"the-pwa\">The PWA</h2>\n<p>The process begins with a PWA, obviously, with all the trimmings.</p>\n<p>I developed an archetypal todo app, but with a twist. The twist is I made it. That means I can only blame myself when it hinders productivity.</p>\n<p>Check out: <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://muteswan.app/\"><strong>MuteSwan.app</strong></a></p>\n<p>It doesn’t really scale well beyond mobile, <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://codepen.io/dbushell/pen/mdJPzrP\">I’m working on that…</a></p>\n<p><strong>Mute Swan</strong> is a short-term daily planner for todos and memos. Add items for the upcoming week. See a history of the past seven days. The app is centred around “today” and older items are automatically deleted.</p>\n<p class=\"b-post__image\">\n  <img loading=\"lazy\" srcset=\"\n    /images/blog/2020/ms-screenshot@1x.png,\n    /images/blog/2020/ms-screenshot@2x.png 2x\"\n    src=\"/images/blog/2020/ms-screenshot@1x.png\"\n    alt=\"Mute Swan PWA Screenshot\"\n    width=\"360\"\n    height=\"640\">\n</p>\n\n<p>And of course, Mute Swan is available on <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://play.google.com/store/apps/details?id=app.muteswan.android\">Google Play</a>:</p>\n<p class=\"b-post__image\">\n  <a style=\"display: block; max-width: 200px;\" target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://play.google.com/store/apps/details?id=app.muteswan.android\">\n    <img loading=\"lazy\" srcset=\"\n      /images/blog/2020/google-play-badge@1x.png,\n      /images/blog/2020/google-play-badge@2x.png 2x\"\n      src=\"/images/blog/2020/google-play-badge@1x.png\"\n      alt=\"Get Mute Swan on Google Play\"\n      width=\"282\"\n      height=\"84\">\n  </a>\n</p>\n\n<p>Here’s how:</p>\n<h2 id=\"android-studio\">Android Studio</h2>\n<p>I followed <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://fireship.io/lessons/pwa-to-play-store/\">Jeff Delaney’s guide</a>. He goes through the key steps to install Android Studio dev environment and submit test releases to the Play Store.</p>\n<p>If you follow the rabbit hole you’ll find <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://github.com/GoogleChromeLabs/llama-pack\">Llama Pack</a>. It appears to be the most up-to-date tool to generate a TWA boilerplate project. This is all that’s needed to bundle the app. There is also <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://github.com/pwa-builder/pwabuilder-android-twa\">PWA Builder</a> which looks similar but I haven’t tested it.</p>\n<p>In theory this only needs to be done once as the TWA app is just a wrapper. All future updates can be done on the PWA side. I suppose it may be justified to submit a new release for the sake of appearances. Users will see changes regardless without an app update (unless the service worker is caching indefinitely).</p>\n<h2 id=\"establishing-trust\">Establishing Trust</h2>\n<p>The “Trusted” part of TWA comes from <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://developers.google.com/digital-asset-links/v1/getting-started\">Digital Asset Links</a>. For the PWA a JSON file must be accessible on a public URL on the same domain. This includes the app bundle fingerprint which basically proves ownership and allows the app to run without Chrome UI (like the address bar).</p>\n<pre><code class=\"language-json\"><span class=\"token comment\">// https://muteswan.app/.well-known/assetlinks.json</span>\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"relation\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"delegate_permission/common.handle_all_urls\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"target\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"namespace\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"android_app\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"package_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"app.muteswan.android\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"sha256_cert_fingerprints\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"D6:04:9A:74:08:FA:90:45:13:6D:25:C4:86:A4:E0:31:8D:CD:72:DF:50:0B:F5:2F:6C:A0:E1:98:A8:D6:65:6F\"</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span></code></pre>\n<p>If “app signing by Google Play” is enabled, the “SHA-256 certificate fingerprint” from the Play Console should be used.</p>\n<p>If the fingerprints do not match users will see the Chrome address bar and other UI. Users may even see an “Add to Home Screen” prompt which is rather confusing. The emulator screenshot below demonstrates this problem.</p>\n<p class=\"b-post__image\">\n  <img loading=\"lazy\" srcset=\"\n    /images/blog/2020/ms-assetslink@1x.png,\n    /images/blog/2020/ms-assetslink@2x.png 2x\"\n    src=\"/images/blog/2020/ms-assetslink@1x.png\"\n    alt=\"Mute Swan TWA Digital Asset Links failure\"\n    width=\"405\"\n    height=\"361.5\">\n</p>\n\n<p>Once that is sorted, the app is good to go!</p>\n<p>A Google Developer account is required with a one-off $25 fee. There’s a whole host of forms to complete in the Play Console. It took a few days (over a weekend) for my Mute Swan app to be approved.</p>\n<h2 id=\"user-experience\">User Experience</h2>\n<p>Aside from the initial installation process there really isn’t much difference between a PWA (via Chrome WebAPK) and a TWA app once launched.</p>\n<p>The PWA splash screen uses the icon, colour, and app name from the <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://developer.mozilla.org/en-US/docs/Web/Manifest\">manifest file</a>. The TWA app only uses the icon by default. I’d assume this is entirely customisable if I were to dig around in the Android Studio project.</p>\n<p>On first launch the user gets a notice at the bottom of the screen:</p>\n<p class=\"b-post__image\">\n  <img loading=\"lazy\" srcset=\"\n    /images/blog/2020/ms-chrome@1x.png,\n    /images/blog/2020/ms-chrome@2x.png 2x\"\n    src=\"/images/blog/2020/ms-chrome@1x.png\"\n    alt=\"Mute Swan TWA 'Running in Chrome' message\"\n    width=\"540\"\n    height=\"70\">\n</p>\n\n<p>I’m not sure what this achieves other than mild confusion.</p>\n<p>A more lasting difference is that the TWA app adopts the dark-mode preference for the Android navigation bar below the app.</p>\n<p class=\"b-post__image\">\n  <img loading=\"lazy\" srcset=\"\n    /images/blog/2020/ms-footer@1x.png,\n    /images/blog/2020/ms-footer@2x.png 2x\"\n    src=\"/images/blog/2020/ms-footer@1x.png\"\n    alt=\"Mute Swan TWA and PWA differences\"\n    width=\"540\"\n    height=\"75\">\n</p>\n\n<p>What’s interesting is that Chrome uses the same user session. Meaning cache storage between the PWA, TWA app, and visiting <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://muteswan.app\">muteswan.app</a> in the browser all share the same data on the device.</p>\n<p>The Firefox PWA bookmark comes in 3rd place. It launches with a white screen and gets the light-mode nav bar.</p>\n<h2 id=\"thoughts\">Thoughts</h2>\n<p>Ideally all browsers would work with the WebAPK approach and Google would allow PWAs to be listed in the app store.</p>\n<p>For now, this approach only takes an afternoon.</p>\n<p>As for <strong>Mute Swan</strong>, I’ve actually been dogfooding it for a few weeks now and plan to maintain it. It’s free to use! Get in touch <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://twitter.com/dbushell\">@dbushell</a> if you care. I plan to release the source code once I clean it up.</p>\n<h2 id=\"react-native\">React Native?</h2>\n<p>My first idea was to bundle the app using <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://reactnative.dev/\">React Native</a>. It’s cross-platform for both Android and iOS. I’ll admit wishful thinking here in regards to shared components with the PWA. It’s not quite as magic as I’d hope. I managed to get the app running by replacing most elements with a <code>&lt;View/&gt;</code> or <code>&lt;Text/&gt;</code>. All the Redux logic worked without change. Other code relying on a browser environment needed more drastic reimplementation (or would have — I gave up.)</p>\n<p>I’d consider React Native if I was serious about a multi-platform app, or required native API integration.</p>\n<h2 id=\"update-for-june-2020\">Update for June 2020</h2>\n<p>I’ve written a new article: <a href=\"/2020/06/01/bubblewrap-twa-pwa-apps-android-studio/\">“Bubblewrap Apps in Android Studio”</a>.</p>\n",
  "pageExcerpt": "A Progressive Web App (PWA) is a website with a few extra pieces.\nPWAs can be installed or bookmarked from the browser using “Add to Home Screen”. On Android 9 doing this via Firefox (v68, left) and Chrome (v80, right) gives two different results on my Samsung S8:\n\n  \n\n\nThe Firefox icon isn’t desirable. Although the […]",
  "pageDesc": "The one where I bundle my totally unique PWA as an Android app.",
  "pageTitle": "Bundle a PWA as an Android App – David Bushell – Web Design (UK)"
}