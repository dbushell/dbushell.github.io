{
  "dateUnix": 1580119200000,
  "dateFormatted": "Monday 27 Jan 2020",
  "pageHeading": "Building a PWA with Netlify Functions",
  "pagePath": "/2020/01/27/building-a-pwa-with-netlify-functions/",
  "innerHTML": "<p>A couple of weeks ago <a href=\"/2020/01/15/netlify-first-impressions/\">I took Netlify for a spin</a>. I found the platform to be much easier to use than I’d anticipated. I was keen to test more features.</p>\n<p><a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://www.netlify.com/products/functions/\">Netlify Functions</a> provide back-end functionality through API endpoints. They’re powered by AWS Lambda. I’m using AWS for my <a href=\"/contact/\">contact form</a>. It took me forever to get working. If you asked me today I legitimately could not tell you how. An abstracted layer sounds like a good feature to me.</p>\n<h2 id=\"the-mission\">The Mission</h2>\n<p>In the spirit of a “friday coding”<sup>†</sup> hackathon I set myself the mission: in one day build a progressive web app that uses Netlify functions. Since I had the domain <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://eavesdrop.app\">eavesdrop.app</a> lying around — snapped it up during the gold rush — I worked backwards from there.</p>\n<p class=\"p--small u-dim\"><sup>†</sup> in which the only standards are those that’re out the door by beer o’clock</p>\n<p class=\"b-post__image\"><img src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjwvc3ZnPg==\" data-lazy=\"false\" data-src=\"/images/blog/2020/eavesdrop.gif\" alt=\"Eavesdrop.app\"></p>\n<p>Inspiration: I’ve been having a problem with <strong>short URLs</strong> recently. They’ll often redirect through tracking domains that are purposefully blocked by either my browser or router. Seems like a decent task for a remote function?</p>\n<p><a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://eavesdrop.app/\"><strong>Eavesdrop</strong></a> works as follows:</p>\n<ol>\n<li>User inputs a short URL</li>\n<li>Form is posted to a Netlify function</li>\n<li>Function runs in the AWS cloud</li>\n<li>Unshortened URL is returned</li>\n</ol>\n<p>It’s far from an original idea but it’s got a cool domain.</p>\n<p>I coded up the <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://codepen.io/dbushell/pen/ZEYwxOe\">front-end UI on CodePen</a>. I then glued it all together with React. You can find the <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://github.com/dbushell/eavesdrop.app\">source code on GitHub</a>. Unfortunately I spent far too long animating the logo so the visual UI feedback is lacking. Functionally it works great though which is the point. I had to remind myself that (after messing with CSS for four hours).</p>\n<p>On the front-end the magic happens with a <code>fetch</code>:</p>\n<pre><code class=\"language-javascript\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/.netlify/functions/unshorten'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  method<span class=\"token operator\">:</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span>\n  headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  body<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>url<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* Success! do stuff... */</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* Error! do stuff... */</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">finally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* clean up? */</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>On the back-end the real magic happens. The <code>unshorten</code> function I borrowed heavily from <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://github.com/lmammino/tall\"><strong>tall</strong></a> by <em>Luciano Mammino</em>. I adapted and wrapped it in Netlify’s handler:</p>\n<pre><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">handler</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">unshorten</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n          statusCode<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n          body<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>url<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>It’s a Node script that follows 301 redirects until someone gives up. It’s not perfect but I’m not prepared to read the HTTP spec to fix edge cases. This project is a proof-of-concept after all.</p>\n<p>It took me a little while to get the function working. My fault; bad API requests and data formatting. Testing was excruciatingly slow until I discovered the <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://cli.netlify.com/commands/dev\">Netlify CLI</a> allows for local development and function invoking.</p>\n<p>Then it worked! Nice. Mission complete.</p>\n<p>Eavesdrop could use some polish but for a day’s work I’m happy with the results. Particularly with how simple it was to deploy on Netlify. Sure, I could roll my own solution on AWS like I did with my contact form, but I’d rather pay for simplicity and convenience. And since I pay nothing on the free plan — even better!</p>\n<p>No doubt I’ll be testing other <a rel=\"noopener noreferrer\" target=\"_blank\" href=\"https://jamstack.org/\">JAMstack</a> services so watch this space.</p>\n",
  "pageExcerpt": "A couple of weeks ago I took Netlify for a spin. I found the platform to be much easier to use than I’d anticipated. I was keen to test more features.\nNetlify Functions provide back-end functionality through API endpoints. They’re powered by AWS Lambda. I’m using AWS for my contact form. It took me forever to […]",
  "pageDesc": "The one where I build a progressive web app to learn Netlify functions.",
  "pageTitle": "Building a PWA with Netlify Functions – David Bushell – Web Design (UK)"
}